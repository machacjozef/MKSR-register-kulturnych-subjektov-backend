<document xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://petriflow.com/petriflow.schema.xsd">
    <id>configuration</id>
    <initials>CFG</initials>
    <title>Konfigurácia</title>
    <icon>device_hub</icon>
    <defaultRole>true</defaultRole>
    <anonymousRole>false</anonymousRole>
    <transitionRole>false</transitionRole>
    <caseName>Konfigurácia</caseName>
	<data type="text">
		<id>new_sector</id>
		<title>Nový sektor</title>
	</data>
	<data type="enumeration_map">
		<id>sectors</id>
		<title>Sektory</title>
	</data>
	<data type="text">
		<id>new_register</id>
		<title>Nový register</title>
	</data>
	<data type="multichoice_map">
		<id>registers</id>
		<title>Registre</title>
	</data>
	<data type="button">
		<id>add_sector</id>
		<title/>
		<placeholder>add</placeholder>
		<component>
			<name>icon</name>
		</component>
	</data>
	<data type="button">
		<id>remove_sectors</id>
		<title/>
		<placeholder>remove</placeholder>
		<component>
			<name>icon</name>
		</component>
	</data>
	<data type="button">
		<id>add_register</id>
		<title/>
		<placeholder>add</placeholder>
		<component>
			<name>icon</name>
		</component>
	</data>
	<data type="button">
		<id>remove_registers</id>
		<title/>
		<placeholder>remove</placeholder>
		<component>
			<name>icon</name>
		</component>
	</data>
    <transition>
        <id>os_config</id>
        <x>100</x>
        <y>100</y>
        <label>Konfigurácia štruktúry</label>
		<assignPolicy>auto</assignPolicy>
        <dataGroup>
			<id>os_config_0</id>
            <cols>4</cols>
            <layout>grid</layout>
            <dataRef>
				<id>sectors</id>
				<logic>
					<behavior>editable</behavior>
				</logic>
				<layout>
					<x>0</x>
					<y>1</y>
					<rows>1</rows>
					<cols>3</cols>
					<template>material</template>
					<appearance>outline</appearance>
				</layout>
			</dataRef>
			<dataRef>
				<id>new_sector</id>
				<logic>
					<behavior>editable</behavior>
				</logic>
				<layout>
					<x>0</x>
					<y>0</y>
					<rows>1</rows>
					<cols>3</cols>
					<template>material</template>
					<appearance>outline</appearance>
				</layout>
			</dataRef>
			<dataRef>
				<id>new_register</id>
				<logic>
					<behavior>editable</behavior>
				</logic>
				<layout>
					<x>0</x>
					<y>2</y>
					<rows>1</rows>
					<cols>3</cols>
					<template>material</template>
					<appearance>outline</appearance>
				</layout>
			</dataRef>
			<dataRef>
				<id>registers</id>
				<logic>
					<behavior>editable</behavior>
				</logic>
				<layout>
					<x>0</x>
					<y>3</y>
					<rows>1</rows>
					<cols>3</cols>
					<template>material</template>
					<appearance>outline</appearance>
				</layout>
			</dataRef>
			<dataRef>
				<id>add_sector</id>
				<logic>
					<behavior>editable</behavior>
				</logic>
				<layout>
					<x>3</x>
					<y>0</y>
					<rows>1</rows>
					<cols>1</cols>
					<template>material</template>
					<appearance>outline</appearance>
				</layout>
				<event type="set">
					<id>add_sector_set</id>
					<actions phase="post">
						<action id="1">sectors: f.sectors,
new_sector: f.new_sector;

if (!new_sector.value) {
    throw new IllegalArgumentException("Nevyplnili ste hodnotu nového sektoru.")
}

change sectors options { sectors.options.plus([(new_sector.value):(new_sector.value)]) }

createOrUpdateFolder(textPreprocess(new_sector.value), textPreprocess(new_sector.value))

setUriNodeData("/" + textPreprocess(new_sector.value), new_sector.value, null, "prompt_suggestion")

change new_sector value { null }</action>
					</actions>
				</event>
			</dataRef>
			<dataRef>
				<id>remove_sectors</id>
				<logic>
					<behavior>visible</behavior>
				</logic>
				<layout>
					<x>3</x>
					<y>1</y>
					<rows>1</rows>
					<cols>1</cols>
					<template>material</template>
					<appearance>outline</appearance>
				</layout>
				<event type="set">
					<id>remove_sectors_set</id>
					<actions phase="post">
						<action id="2">sectors: f.sectors;

        if (!sectors.value) {
            return
        }

        def newOptions = sectors.options
        sectors.value.each{
            newOptions = newOptions.remove(it)
        }

        change sectors options { newOptions }
        change sectors value { null }</action>
					</actions>
				</event>
			</dataRef>
			<dataRef>
				<id>add_register</id>
				<logic>
					<behavior>editable</behavior>
				</logic>
				<layout>
					<x>3</x>
					<y>2</y>
					<rows>1</rows>
					<cols>1</cols>
					<template>material</template>
					<appearance>outline</appearance>
				</layout>
				<event type="set">
					<id>add_register_set</id>
					<actions phase="post">
						<action id="3">registers: f.registers,
sectors: f.sectors,
new_register: f.new_register;


if (!new_register.value) {
    throw new IllegalArgumentException("Nevyplnili ste hodnotu nového registra.")
}

if (!sectors.value) {
	throw new IllegalArgumentException("Nie je vybrané sektoru.")
}

change registers options { registers.options.plus([(new_register.value):(new_register.value)]) }

createOrUpdateMenuItem(textPreprocess(new_register.value),
("/" + textPreprocess(sectors.value.toString())),
"Case",
"processIdentifier:\"configuration\"",
"settings",
new_register.value,
[])

deepCopyAndRenameTransition(textPreprocess(sectors.value.toString() + "/" + new_register.value))

change new_register value { null }
						</action>
					</actions>
				</event>
			</dataRef>
			<dataRef>
				<id>remove_registers</id>
				<logic>
					<behavior>visible</behavior>
				</logic>
				<layout>
					<x>3</x>
					<y>3</y>
					<rows>1</rows>
					<cols>1</cols>
					<template>material</template>
					<appearance>outline</appearance>
				</layout>
				<event type="set">
					<id>remove_registers_set</id>
					<actions phase="post">
						<action id="4">registers: f.registers;

        if (!registers.value) {
            return
        }

        def newOptions = registers.options
        registers.value.each{
            newOptions = newOptions.remove(it.toString())
        }

        change registers options { newOptions }
        change registers value { null }</action>
					</actions>
				</event>
            </dataRef>
        </dataGroup>
        <event type="assign">
            <id>os_config_assign</id>
        </event>
        <event type="finish">
            <id>os_config_finish</id>
        </event>
        <event type="cancel">
            <id>os_config_cancel</id>
        </event>
        <event type="delegate">
            <id>os_config_delegate</id>
        </event>
    </transition>
    <transition>
        <id>register_config</id>
		<x>340</x>
        <y>100</y>
        <label>Konfigurácia registrov</label>
        <event type="assign">
            <id>register_config_assign</id>
        </event>
        <event type="finish">
            <id>register_config_finish</id>
        </event>
        <event type="cancel">
            <id>register_config_cancel</id>
        </event>
        <event type="delegate">
            <id>register_config_delegate</id>
        </event>
    </transition>
</document>
